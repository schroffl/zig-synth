<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zig Synthesizer in WebAssembly</title>

    <style>
        body {
            font-family: Arial;
            margin: 0px;
            overflow: hidden;
        }

        #play-button {
            font-size: 42px;
            background-color: mediumpurple;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            box-shadow: #000 0px 5px 10px;
            margin-bottom: 20px;
            padding: 8px 16px;
        }

        #play-button:hover, #play-button:focus {
            outline: none;
            background-color: #5b32af;
        }

        #play-button:active {
            margin-top: 2px;
            margin-bottom: 18px;
            box-shadow: #000 0px 2px 6px;
        }

        .note {
            font-family: "Comic Sans MS";
            max-width: 50%;
            text-align: center;
        }

        .hash {
            position: absolute;
            cursor: help;
            top: 8px;
            left: 8px;
            color: rgba(0, 0, 0, 0.3);
        }

        .hash:hover {
            color: black;
        }

        @media (prefers-color-scheme: light) {
        }

        @media (prefers-color-scheme: dark) {
            body {
                background-color: #444;
                color: #eee;
            }

            .hash {
                color: rgba(238, 238, 238, 0.3);
            }

            .hash:hover {
                color: #eee;
            }
        }

        .button-wrapper {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;

            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="button-wrapper">
        <button id="play-button">Start</button>
        <div class="note">
            This button is required, because your browser prevents audio from playing automatically.
            Connect a MIDI input device and start playing.

            <hr>

            <small>
                Due to missing API implementations in most browsers, this is currently only known to work in Google Chrome.
                <br>
                Check <a href="https://caniuse.com/#search=Audio%20Worklet">Audio Worklet Support</a> to find out if this has changed.
            </small>
        </div>
        <div class="hash" title="This mainly exists to check weird browser cache behaviour">Build: c6abb87f3ee58b82</div>
    </div>

    <script>
        window.workletSource = "data:text/javascript;base64,ZnVuY3Rpb24gZ2V0U3RyaW5nKGluc3QsIHB0ciwgbGVuKSB7CiAgICBjb25zdCBzbGljZSA9IGRlcmVmQnVmZmVyKFVpbnQ4QXJyYXksIGluc3QsIHB0ciwgbGVuKTsKICAgIGNvbnN0IGFyciA9IFtdOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2xpY2UubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBjaGFyID0gU3RyaW5nLmZyb21DaGFyQ29kZShzbGljZVtpXSk7CiAgICAgICAgYXJyLnB1c2goY2hhcik7CiAgICB9CgogICAgcmV0dXJuIGFyci5qb2luKCcnKTsKfQoKZnVuY3Rpb24gZGVyZWZCdWZmZXIoVCwgaW5zdCwgcHRyLCBsZW4pIHsKICAgIHJldHVybiBuZXcgVChpbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciwgcHRyLCBsZW4pOwp9CgpmdW5jdGlvbiBhbGxvY0J1ZmZlcihULCBpbnN0LCBsZW4pIHsKICAgIGNvbnN0IHB0ciA9IGluc3QuZXhwb3J0cy5qc19hbGxvYyhULkJZVEVTX1BFUl9FTEVNRU5UICogbGVuKTsKCiAgICByZXR1cm4gewogICAgICAgIHB0cjogcHRyLAogICAgICAgIGRhdGE6IGRlcmVmQnVmZmVyKFQsIGluc3QsIHB0ciwgbGVuKSwKICAgIH07Cn0KCmZ1bmN0aW9uIGZyZWVCdWZmZXIoaW5zdCwgYnVmZmVyKSB7CiAgICBpbnN0LmV4cG9ydHMuanNfZnJlZShidWZmZXIucHRyLCBidWZmZXIuZGF0YS5ieXRlTGVuZ3RoKTsKfQoKY2xhc3MgWmlnU3ludGhQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewoKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CgogICAgICAgIHRoaXMucG9ydC5vbm1lc3NhZ2UgPSB0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpOwogICAgfQoKICAgIGluaXRXYXNtKGJpbmFyeSwgc2FtcGxlX3JhdGUpIHsKICAgICAgICBsZXQgaW5zdGFuY2VfY2xvc3VyZSA9IHVuZGVmaW5lZDsKCiAgICAgICAgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoYmluYXJ5LCB7CiAgICAgICAgICAgIGRlYnVnOiB7CiAgICAgICAgICAgICAgICBqc19lcnI6IChwdHIsIGxlbikgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9IGdldFN0cmluZyhpbnN0YW5jZV9jbG9zdXJlLCBwdHIsIGxlbik7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihtc2cpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGpzX3dhcm46IChwdHIsIGxlbikgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9IGdldFN0cmluZyhpbnN0YW5jZV9jbG9zdXJlLCBwdHIsIGxlbik7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobXNnKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSkudGhlbihpbnN0ID0+IHsKICAgICAgICAgICAgaW5zdGFuY2VfY2xvc3VyZSA9IGluc3QuaW5zdGFuY2U7CiAgICAgICAgICAgIGluc3QuaW5zdGFuY2UuZXhwb3J0cy5pbml0X3N5bnRoKHNhbXBsZV9yYXRlKTsKICAgICAgICAgICAgdGhpcy53YXNtID0gaW5zdC5pbnN0YW5jZTsKICAgICAgICB9KTsKICAgIH0KCiAgICBvbk1lc3NhZ2UoZXZlbnQpIHsKICAgICAgICBzd2l0Y2ggKGV2ZW50LmRhdGEudHlwZSkgewogICAgICAgICAgICBjYXNlICd3YXNtLWJpbmFyeSc6IHsKICAgICAgICAgICAgICAgIHRoaXMuaW5pdFdhc20oZXZlbnQuZGF0YS5kYXRhLCBldmVudC5kYXRhLnNhbXBsZV9yYXRlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlICdtaWRpLW1lc3NhZ2UnOiB7CiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NNSURJKGV2ZW50LmRhdGEuZGF0YSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzTUlESShkYXRhKSB7CiAgICAgICAgY29uc3QgYnVmZmVyID0gYWxsb2NCdWZmZXIoVWludDhBcnJheSwgdGhpcy53YXNtLCBkYXRhLmJ5dGVMZW5ndGgpOwoKICAgICAgICBidWZmZXIuZGF0YS5zZXQoZGF0YSk7CiAgICAgICAgdGhpcy53YXNtLmV4cG9ydHMucHJvY2Vzc19taWRpKGJ1ZmZlci5wdHIsIGRhdGEuYnl0ZUxlbmd0aCk7CgogICAgICAgIGZyZWVCdWZmZXIodGhpcy53YXNtLCBidWZmZXIpOwogICAgfQoKICAgIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbXMpIHsKICAgICAgICBpZiAoIXRoaXMud2FzbSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGNoYW5uZWwgPSBvdXRwdXRzWzBdWzBdOwogICAgICAgIGNvbnN0IGJ1ZmZlciA9IGFsbG9jQnVmZmVyKEZsb2F0MzJBcnJheSwgdGhpcy53YXNtLCBjaGFubmVsLmxlbmd0aCk7CgogICAgICAgIHRoaXMud2FzbS5leHBvcnRzLmdlbmVyYXRlKGJ1ZmZlci5wdHIsIGJ1ZmZlci5kYXRhLmxlbmd0aCk7CiAgICAgICAgY2hhbm5lbC5zZXQoYnVmZmVyLmRhdGEpOwoKICAgICAgICBmcmVlQnVmZmVyKHRoaXMud2FzbSwgYnVmZmVyKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgp9CgpyZWdpc3RlclByb2Nlc3NvcignemlnLXN5bnRoJywgWmlnU3ludGhQcm9jZXNzb3IpOwo=";
        window.wasmSource = "data:application/octet-stream;base64,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";
    </script>
    <script>

function drawOscilloscope(ctx, audio_ctx, data) {}

function clear(ctx) {
    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
}

function numMap(x, min, max, new_min, new_max) {
    return (x - min) * (new_max - new_min) / (max - min) + new_min;
}

function drawFrequencies(ctx, audio_ctx, data) {
    const dbToY = db => numMap(db, -120, 6, ctx.canvas.height, 0);
    const freqToX = freq => {
        if (freq === -1) {
            return 0;
        }

        return Math.log10(freq + 1) / Math.log10(audio_ctx.sampleRate / 2) * ctx.canvas.width
    };

    const db_lines = [0, -20, -40, -60, -80, -100, -120];
    db_lines.forEach(db => {
        const y = dbToY(db);

        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(ctx.canvas.width, y);
        ctx.lineWidth = 1;
        ctx.strokeStyle = 'gray';
        ctx.stroke();

        ctx.beginPath();
        ctx.strokeStyle = 'orange';
        ctx.strokeText(`${db} dB`, 4, y - 4);
    });


    const calcX = x => Math.log10(x) / Math.log10(data.length) * ctx.canvas.width;
    const freq_lines = [1, 10, 100, 1000, 10000];

    freq_lines.forEach(freq => {
        const x = freqToX(freq);

        ctx.beginPath();
        ctx.lineWidth = 1;
        ctx.strokeStyle = 'black';
        ctx.moveTo(x, 0);
        ctx.lineTo(x, ctx.canvas.height);
        ctx.stroke();

        for (let i = 1; i < 10; i++) {
            const thin_x = freqToX(freq + i * freq);

            ctx.beginPath();
            ctx.moveTo(thin_x, 0);
            ctx.lineTo(thin_x, ctx.canvas.height);
            ctx.lineWidth = 1;
            ctx.strokeStyle = 'gray';
            ctx.stroke();
        }

        ctx.beginPath();
        ctx.strokeStyle = 'orange';
        ctx.strokeText(`${freq} Hz`, x + 4, dbToY(0) - 4);
    });

    ctx.beginPath();

    const minp = 0;
    const maxp = audio_ctx.sampleRate / 2;

    const minv = Math.log(0);
    const maxv = Math.log(audio_ctx.sampleRate / 2);
    const scale = (maxv - minv) / (maxp - minp);

    data.forEach((value, i) => {
        const frequency = i * (audio_ctx.sampleRate / 2) / data.length;
        const x = freqToX(frequency);
        const y = numMap(value, -140, 6, ctx.canvas.height, 0);

        if (i == 0) {
            ctx.moveTo(x, y);
            return;
        }

        ctx.lineTo(x, y);
    });

    ctx.strokeStyle = 'blue';
    ctx.lineWidth = 2;
    ctx.stroke();
}

function drawOscilloscope(ctx, audio_ctx, data) {

    ctx.beginPath();
    ctx.moveTo(0, ctx.canvas.height / 2);
    ctx.lineTo(ctx.canvas.width, ctx.canvas.height / 2);
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.beginPath();
    data.forEach((value, i) => {
        const x = (data.length - i) / data.length * ctx.canvas.width;
        const y = ctx.canvas.height / 2 - value * (ctx.canvas.height / 2);

        if (i == 0) {
            ctx.moveTo(x, y);
            return;
        }

        ctx.lineTo(x, y);
    });

    ctx.strokeStyle = 'blue';
    ctx.lineWidth = 2;
    ctx.stroke();
}

const wasm_binary_promise = fetch(window.wasmSource).then(res => res.arrayBuffer());
const play_button = document.getElementById('play-button');

let running = false;

play_button.addEventListener('click', e => start());

window.addEventListener('keydown', onKeyDown);

function onKeyDown(e) {
    window.removeEventListener('keydown', onKeyDown);

    if (e.code === 'Space') {
        start();
    }
}

function start() {
    if (running) {
        return;
    }

    running = true;

    const wrapper = play_button.parentElement;
    wrapper.parentElement.removeChild(wrapper);

    const canvas_spectrum = document.createElement('canvas');
    const canvas_oscilloscope = document.createElement('canvas');
    const ctx_spectrum = canvas_spectrum.getContext('2d');
    const ctx_oscilloscope = canvas_oscilloscope.getContext('2d');

    canvas_spectrum.height = canvas_oscilloscope.height = window.innerHeight / 2;
    canvas_spectrum.width = canvas_oscilloscope.width = window.innerWidth;

    document.body.appendChild(canvas_spectrum);
    document.body.appendChild(canvas_oscilloscope);

    const audio_ctx = new AudioContext();

    audio_ctx.audioWorklet.addModule(window.workletSource).then(() => {
        const analyser = audio_ctx.createAnalyser();

        analyser.fftSize = 512;
        let frequencies = new Float32Array(analyser.frequencyBinCount);
        let samples = new Float32Array(512);

        analyser.smoothingTimeConstant = 0.5;

        function render(t) {

            clear(ctx_spectrum);
            analyser.getFloatFrequencyData(frequencies);
            drawFrequencies(ctx_spectrum, audio_ctx, frequencies);

            clear(ctx_oscilloscope);
            analyser.getFloatTimeDomainData(samples);
            drawOscilloscope(ctx_oscilloscope, audio_ctx, samples);

            requestAnimationFrame(render);
        }

        requestAnimationFrame(render);

        const synth_node = new AudioWorkletNode(audio_ctx, 'zig-synth', {});
        synth_node.connect(analyser).connect(audio_ctx.destination);

        wasm_binary_promise .then(binary => {
            synth_node.port.postMessage({
                type: 'wasm-binary',
                data: binary,
                sample_rate: audio_ctx.sampleRate,
            });
        }).catch(console.error);

        navigator.requestMIDIAccess().then(access => {
            const inputs = access.inputs.values();

            for (const entry of inputs) {
                entry.addEventListener('midimessage', e => {
                    if (synth_node) {
                        synth_node.port.postMessage({
                            type: 'midi-message',
                            data: e.data,
                        });
                    }
                });
            }
        }).catch(console.error);
    });
}

</script>
</body>
</html>
